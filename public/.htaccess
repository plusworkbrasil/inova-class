# Configuração do .htaccess para cPanel
RewriteEngine On

# Forçar HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Bloquear acesso a arquivos sensíveis
<FilesMatch "\.(env|log|sql|sh|bat)$">
    Require all denied
</FilesMatch>

# Bloquear acesso a diretórios específicos
RedirectMatch 403 ^/api/config/
RedirectMatch 403 ^/api/logs/
RedirectMatch 403 ^/install\.(php|bat|sh)$

# API routes - não redirecionar para index.html
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^.*$ - [L]

# Arquivos estáticos existentes
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^.*$ - [L]

# SPA - redirecionar todas as outras rotas para index.html
RewriteRule ^.*$ index.html [L]

# Headers de segurança
<IfModule mod_headers.c>
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# Cache para arquivos estáticos
<FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
    </IfModule>
    <IfModule mod_headers.c>
        Header set Cache-Control "public, immutable, max-age=2592000"
    </IfModule>
</FilesMatch>

# Compressão Gzip
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# Bloquear bots maliciosos
<RequireAll>
    Require all granted
    Require not env bad-bot
</RequireAll>

SetEnvIfNoCase User-Agent "BadBot|MaliciousBot|Crawler" bad-bot